# 📦 打包指南 - Windows 可执行程序

本指南介绍如何将班级任务统计助手打包为 Windows 可执行程序（.exe）。

## 📋 打包前准备

### 1. 安装依赖

首先安装 electron-builder：

```bash
npm install electron-builder --save-dev
```

或者使用 yarn：

```bash
yarn add electron-builder --dev
```

### 2. 准备图标（可选但推荐）

1. 创建 `assets/` 目录
2. 准备 256x256 的 PNG 图片
3. 转换为 `.ico` 格式（参见 `assets/图标说明.md`）
4. 命名为 `icon.ico` 并放到 `assets/` 目录

如果没有图标，打包时会使用 Electron 默认图标。

### 3. 检查 package.json

确保已经添加了打包配置。如果没有，请手动添加以下配置：

```json
{
  "scripts": {
    "build": "electron-builder",
    "build:win": "electron-builder --win",
    "build:win:portable": "electron-builder --win portable",
    "build:dir": "electron-builder --dir"
  },
  "build": {
    "appId": "com.pandajsr.class-task-tracker",
    "productName": "班级任务统计助手",
    "directories": {
      "output": "dist"
    },
    "win": {
      "icon": "assets/icon.ico",
      "target": [
        {
          "target": "nsis",
          "arch": ["x64", "ia32"]
        },
        {
          "target": "portable",
          "arch": ["x64", "ia32"]
        }
      ]
    },
    "nsis": {
      "oneClick": false,
      "allowToChangeInstallationDirectory": true,
      "createDesktopShortcut": true,
      "createStartMenuShortcut": true
    }
  }
}
```

## 🏗️ 打包方式

提供多种打包选项：

### 方式1：完整安装程序（推荐）

生成标准的 Windows 安装程序（.exe）：

```bash
npm run build:win
```

输出文件：
```
dist/
└── 班级任务统计助手 Setup 1.0.0.exe  (安装程序)
```

特点：
- ✅ 提供安装向导
- ✅ 可自定义安装路径
- ✅ 支持开机启动和桌面快捷方式
- ✅ 可卸载

### 方式2：绿色便携版

生成单文件便携版，无需安装：

```bash
npm run build:win:portable
```

输出文件：
```
dist/
└── 班级任务统计助手.exe  (单文件，可直接运行)
```

特点：
- ✅ 单文件，体积较小
- ✅ 无需安装，解压即用
- ✅ 可放在 U 盘随身携带
- ✅ 不会在系统留下痕迹

### 方式3：快速测试构建

仅生成未打包的应用目录（测试用）：

```bash
npm run build:dir
```

输出文件：
```
dist/
└── win-unpacked/
    ├── 班级任务统计助手.exe
    └── resources/ (资源文件)
```

特点：
- ✅ 构建速度快
- ✅ 可立即测试
- ✅ 适合开发调试

### 方式4：完整打包

同时生成安装程序和便携版：

```bash
npm run build
```

输出文件：
```
dist/
├── 班级任务统计助手 Setup 1.0.0.exe  (安装程序)
├── 班级任务统计助手 Setup 1.0.0.exe.blockmap
├── 班级任务统计助手.exe  (便携版)
└── ...
```

## ⏱️ 打包时间参考

根据电脑配置不同：

- `build:dir` - 30秒 ~ 1分钟
- `build:win:portable` - 2分钟 ~ 5分钟
- `build:win` - 3分钟 ~ 8分钟
- `build` - 5分钟 ~ 10分钟

首次打包需要下载依赖，时间较长；后续打包会快很多。

## 📦 输出文件说明

打包完成后，在 `dist/` 目录下：

```
dist/
├── 班级任务统计助手 Setup 1.0.0.exe         # NSIS 安装程序
├── 班级任务统计助手 Setup 1.0.0.exe.blockmap  # 用于增量更新
├── 班级任务统计助手.exe                     # 绿色便携版
├── builder-debug.yml                         # 构建调试信息
└── win-unpacked/                             # 未打包版本（如果使用了 --dir）
    ├── 班级任务统计助手.exe
    ├── resources/
    └── ...
```

## 🚀 安装和分发

### 安装版使用

1. 运行 `班级任务统计助手 Setup 1.0.0.exe`
2. 选择安装路径（默认：C:\Program Files\班级任务统计助手）
3. 选择创建快捷方式
4. 点击安装
5. 从桌面或开始菜单启动

### 便携版使用

1. 解压或直接运行 `班级任务统计助手.exe`
2. 可直接运行，无需安装
3. 建议创建桌面快捷方式

### 分发方式

- **在线分发**：上传到网盘、GitHub Releases
- **离线分发**：U盘、局域网共享
- **自动更新**：可配置 electron-updater 实现自动更新

## ⚠️ 注意事项

### 1. 图标问题
如果没有 `assets/icon.ico`，打包时会使用默认 Electron 图标。

### 2. 文件大小
安装版：约 50-60MB（包含 Electron 运行时）
便携版：约 45-55MB

### 3. Windows 版本兼容性
支持 Windows 7 及以上版本。

### 4. 杀毒软件
首次运行可能被杀毒软件拦截，需要添加信任。

### 5. 测试建议
打包后务必在干净的 Windows 环境测试，确保功能正常。

## 🔧 进阶配置

### 添加版本信息

在 package.json 中添加：

```json
{
  "version": "1.0.0",
  "description": "班级任务统计助手",
  "author": {
    "name": "PANDA-JSR",
    "email": "your-email@example.com"
  }
}
```

### 配置自动更新

安装 electron-updater：

```bash
npm install electron-updater
```

然后在 main.js 中添加自动更新逻辑。

### 代码签名（可选）

如果要避免杀毒软件误报，建议购买代码签名证书：

```bash
electron-builder --win -c.win.certificateFile="path/to/cert.pfx" -c.win.certificatePassword="password"
```

### 压缩资源

在 build 配置中添加：

```json
{
  "build": {
    "asar": true,
    "asarUnpack": [
      "**/*.node"
    ]
  }
}
```

## 🆘 常见问题

### Q1: 打包失败，提示缺少依赖？
A: 删除 node_modules 重新安装：
```bash
rm -rf node_modules
npm install
```

### Q2: 打包后的应用白屏？
A: 检查 main.js 中的路径是否正确，使用 __dirname。

### Q3: 如何在其他电脑测试？
A: 在虚拟机或另一台电脑测试，不要在开发机上测试（可能有缓存）。

### Q4: 打包后的文件太大？
A: 这是正常的，Electron 包含了完整的 Chromium 运行时。

### Q5: 如何减小体积？
A: 使用 electron-builder 的压缩选项，或在打包时排除不必要的文件。

## 📞 获取帮助

- 查看 [electron-builder 文档](https://www.electron.build/)
- 检查项目 Issues
- 提交新的 Issue

---

**打包完成后，你的应用就可以分发给其他人使用了！** 🎉
